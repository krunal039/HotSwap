<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HotSwap</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <h1>HotSwap</h1>
        <div class="header-controls">
          <button id="darkModeBtn" class="icon-btn" title="Toggle Dark Mode">üåô</button>
          <div class="global-toggle">
            <label class="switch">
              <input type="checkbox" id="globalEnabled">
              <span class="slider"></span>
            </label>
            <span id="globalStatus">Enabled</span>
          </div>
        </div>
      </div>
      <div class="header-options">
        <label class="csp-toggle">
          <input type="checkbox" id="stripCSP" checked>
          <span>Strip CSP Headers</span>
        </label>
        <div class="profile-selector">
          <select id="profileSelect">
            <option value="default">Default Profile</option>
          </select>
          <button id="profileMenuBtn" class="icon-btn-small" title="Profile Options">‚ãÆ</button>
        </div>
      </div>
      <div id="profileMenu" class="dropdown-menu hidden">
        <button id="newProfileBtn">‚ûï New Profile</button>
        <button id="duplicateProfileBtn">üìã Duplicate Profile</button>
        <button id="renameProfileBtn">‚úèÔ∏è Rename Profile</button>
        <button id="deleteProfileBtn" class="danger">üóëÔ∏è Delete Profile</button>
      </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab-btn active" data-tab="rules">Rules</button>
      <button class="tab-btn" data-tab="logs">Logs</button>
      <button class="tab-btn" data-tab="help">Help</button>
      <button class="tab-btn" data-tab="import">Settings</button>
    </nav>

    <!-- Rules Tab (Combined Add/Edit/Delete) -->
    <section id="rules-tab" class="tab-content active">
      <!-- Add New Rule Button + Search -->
      <div class="add-rule-header">
        <button id="toggleAddForm" class="btn btn-primary btn-add-new">
          <span class="btn-icon">+</span> Add New Rule
        </button>
        <input type="text" id="searchRules" class="search-input" placeholder="Search rules...">
      </div>
      
      <!-- Add Rule Form (Collapsible) -->
      <div id="addRuleFormContainer" class="add-rule-form-container hidden">
        <form id="add-rule-form" class="rule-form">
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="ruleName">Rule Name</label>
              <input type="text" id="ruleName" placeholder="e.g., PCF Control Debug" required>
            </div>
            <div class="form-group">
              <label for="ruleType">Type</label>
              <select id="ruleType" class="select-small">
                <option value="redirect">Redirect</option>
                <option value="block">Block</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="sourceUrl">Source URL Pattern</label>
            <input type="text" id="sourceUrl" placeholder="e.g., *bundle*.js or *cdn.example.com/*.js" required>
            <div class="pattern-type">
              <label class="checkbox-inline">
                <input type="checkbox" id="useRegex"> Use Regex Pattern
              </label>
              <span class="pattern-hint" id="patternHint">Using wildcards (*)</span>
            </div>
          </div>
          
          <div class="form-group" id="targetUrlGroup">
            <label for="targetUrl">Target URL (Redirect To)</label>
            <input type="text" id="targetUrl" placeholder="e.g., http://localhost:8181/bundle.js">
            <small class="capture-hint">Use $1, $2, etc. for regex capture groups</small>
          </div>
          
          <div class="form-group">
            <label for="domains">Limit to Domains <span class="optional">(optional)</span></label>
            <input type="text" id="domains" placeholder="e.g., crm.dynamics.com">
          </div>
          
          <details class="advanced-options">
            <summary>Advanced Options</summary>
            <div class="form-group">
              <label>Resource Types</label>
              <div class="checkbox-group compact">
                <label><input type="checkbox" name="resourceType" value="script" checked> Scripts</label>
                <label><input type="checkbox" name="resourceType" value="xmlhttprequest" checked> XHR</label>
                <label><input type="checkbox" name="resourceType" value="stylesheet"> CSS</label>
                <label><input type="checkbox" name="resourceType" value="image"> Images</label>
                <label><input type="checkbox" name="resourceType" value="font"> Fonts</label>
                <label><input type="checkbox" name="resourceType" value="media"> Media</label>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="priority">Priority</label>
                <input type="number" id="priority" value="1" min="1" max="100" class="input-small">
              </div>
              <div class="form-group" id="delayGroup">
                <label for="delay">Delay (ms)</label>
                <input type="number" id="delay" value="0" min="0" max="10000" class="input-small">
              </div>
            </div>
          </details>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitRuleBtn">Add Rule</button>
            <button type="button" class="btn btn-secondary" id="cancelAddRule">Cancel</button>
          </div>
        </form>
      </div>
      
      <!-- Rules List -->
      <div id="rules-list" class="rules-list">
        <p class="empty-state">No rules configured. Click "Add New Rule" to get started.</p>
      </div>
    </section>

    <!-- Logs Tab -->
    <section id="logs-tab" class="tab-content">
      <div class="logs-header">
        <h3>Activity Logs</h3>
        <div class="logs-actions">
          <button id="resetStatsBtn" class="btn btn-secondary btn-small">Reset Stats</button>
          <button id="clearLogsBtn" class="btn btn-secondary btn-small">Clear Logs</button>
        </div>
      </div>
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-value" id="totalRedirects">0</span>
          <span class="stat-label">Redirects</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="totalBlocks">0</span>
          <span class="stat-label">Blocks</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="activeRulesCount">0</span>
          <span class="stat-label">Active Rules</span>
        </div>
      </div>
      <div class="logs-info">
        <small>Shows URLs that have been redirected/blocked by your rules. Logs clear when extension reloads.</small>
      </div>
      <div id="logs-list" class="logs-list">
        <p class="empty-state">No activity logged yet. Activity will appear here when URLs match your rules.</p>
      </div>
    </section>

    <!-- Help Tab -->
    <section id="help-tab" class="tab-content">
      <!-- About Section -->
      <div class="help-about">
        <div class="help-logo">
          <span class="logo-icon">‚áÑ</span>
          <div class="logo-text">
            <h2>HotSwap</h2>
            <span class="version-badge">v1.1.0</span>
          </div>
        </div>
        <p class="help-tagline">URL Redirect, Block & Mock Extension for Development</p>
        <div class="help-meta">
          <p><strong>Created by:</strong> Krunal Patel</p>
          <p><strong>License:</strong> MIT License</p>
          <p><a href="https://github.com/krunal039/HotSwap" target="_blank">GitHub Repository</a></p>
        </div>
      </div>

      <div class="help-divider"></div>

      <!-- Quick Start -->
      <div class="help-section">
        <h3>Quick Start</h3>
        <ol class="help-steps">
          <li>Click <strong>"+ Add New Rule"</strong></li>
          <li>Enter a <strong>Rule Name</strong> (e.g., "My PCF Debug")</li>
          <li>Select <strong>Type</strong>: Redirect or Block</li>
          <li>Enter <strong>Source URL Pattern</strong> (e.g., <code>*bundle*.js</code>)</li>
          <li>Enter <strong>Target URL</strong> for redirects</li>
          <li>Click <strong>Add Rule</strong> and refresh your page!</li>
        </ol>
      </div>

      <div class="help-divider"></div>

      <!-- Pattern Help -->
      <div class="help-section">
        <h3>URL Patterns</h3>
        
        <h4>Simple Patterns (Regex OFF)</h4>
        <p class="help-description">Use <code>*</code> as a wildcard to match any characters.</p>
        <div class="help-examples">
          <div class="example">
            <code>*bundle*.js</code>
            <span>Matches any URL containing "bundle" ending in ".js"</span>
          </div>
          <div class="example">
            <code>*cdn.example.com/*.js</code>
            <span>Matches JS files from cdn.example.com</span>
          </div>
        </div>

        <h4>Regex Patterns with Capture Groups</h4>
        <p class="help-description">Use full regex syntax. Reference captured groups in target URL with $1, $2, etc.</p>
        <div class="help-examples">
          <div class="example">
            <code>.*/(bundle\.[A-Z0-9]+\.js)$</code>
            <span>Source: Captures filename in $1</span>
          </div>
          <div class="example">
            <code>http://localhost:8181/$1</code>
            <span>Target: Uses captured filename</span>
          </div>
        </div>

        <div class="help-warning">
          <strong>Common Mistake:</strong> Using <code>*bundle*.js</code> with Regex ON won't work! 
          In regex, <code>*</code> means "repeat previous character". Use <code>.*</code> instead.
        </div>
      </div>

      <div class="help-divider"></div>

      <!-- Features -->
      <div class="help-section">
        <h3>Features</h3>
        <ul class="help-features">
          <li><strong>Redirect:</strong> Replace production URLs with localhost for debugging</li>
          <li><strong>Block:</strong> Block unwanted requests (analytics, ads, etc.)</li>
          <li><strong>Capture Groups:</strong> Use $1, $2 in redirect URLs for dynamic rewriting</li>
          <li><strong>Profiles:</strong> Switch between different rule sets quickly</li>
          <li><strong>Context Menu:</strong> Right-click any link to add a rule</li>
          <li><strong>Keyboard Shortcut:</strong> Ctrl+Shift+H (Cmd+Shift+H on Mac) to toggle</li>
          <li><strong>Strip CSP Headers:</strong> Automatically removes CSP so localhost works</li>
          <li><strong>Dark Mode:</strong> Toggle with the moon icon</li>
          <li><strong>Import/Export:</strong> Share configurations as JSON</li>
        </ul>
      </div>

      <div class="help-divider"></div>

      <!-- Troubleshooting -->
      <div class="help-section">
        <h3>Troubleshooting</h3>
        <div class="help-faq">
          <div class="faq-item">
            <strong>Rules not working?</strong>
            <p>Go to Settings ‚Üí Click "View Active Chrome Rules". If empty, your pattern is invalid.</p>
          </div>
          <div class="faq-item">
            <strong>CSP Error?</strong>
            <p>Make sure "Strip CSP Headers" is ON. Add the domain to "Limit to Domains" field.</p>
          </div>
          <div class="faq-item">
            <strong>Capture groups not working?</strong>
            <p>Make sure "Use Regex Pattern" is checked and parentheses surround what you want to capture.</p>
          </div>
        </div>
      </div>

      <div class="help-divider"></div>

      <!-- License -->
      <div class="help-section help-license">
        <h3>MIT License</h3>
        <p>Copyright ¬© 2026 Krunal Patel</p>
        <p class="license-text">
          Permission is hereby granted, free of charge, to any person obtaining a copy of this software 
          to deal in the Software without restriction, including the rights to use, copy, modify, merge, 
          publish, distribute, sublicense, and/or sell copies of the Software.
        </p>
      </div>
    </section>

    <!-- Import/Export Tab -->
    <section id="import-tab" class="tab-content">
      <div class="import-export">
        <div class="form-group">
          <label>Export Rules</label>
          <button id="exportBtn" class="btn btn-secondary">Export to JSON</button>
        </div>
        
        <div class="form-group">
          <label>Import Rules</label>
          <textarea id="importData" placeholder="Paste JSON configuration here..."></textarea>
          <button id="importBtn" class="btn btn-primary">Import Rules</button>
        </div>
        
        <div class="form-group danger-zone">
          <label>Danger Zone</label>
          <button id="clearAllBtn" class="btn btn-danger">Clear All Rules</button>
        </div>
        
        <div class="form-group debug-section">
          <label>Debug Tools</label>
          <button id="viewActiveRulesBtn" class="btn btn-secondary">View Active Chrome Rules</button>
          <div id="activeRulesOutput" class="debug-output"></div>
        </div>
        
        <div class="form-group">
          <label>Test Pattern</label>
          <input type="text" id="testPattern" placeholder="Your pattern (e.g., *bundle*.js)">
          <label class="checkbox-inline" style="margin-top: 6px;">
            <input type="checkbox" id="testUseRegex"> Regex
          </label>
          <input type="text" id="testUrl" placeholder="URL to test against" style="margin-top: 6px;">
          <button id="testPatternBtn" class="btn btn-secondary" style="margin-top: 6px;">Test Match</button>
          <div id="testResult" class="debug-output"></div>
        </div>
        
      </div>
    </section>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h2>Edit Rule</h2>
        <form id="edit-rule-form" class="rule-form">
          <input type="hidden" id="editIndex">
          
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="editRuleName">Rule Name</label>
              <input type="text" id="editRuleName" required>
            </div>
            <div class="form-group">
              <label for="editRuleType">Type</label>
              <select id="editRuleType" class="select-small">
                <option value="redirect">Redirect</option>
                <option value="block">Block</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="editSourceUrl">Source URL Pattern</label>
            <input type="text" id="editSourceUrl" required>
            <div class="pattern-type">
              <label class="checkbox-inline">
                <input type="checkbox" id="editUseRegex"> Use Regex Pattern
              </label>
            </div>
          </div>
          
          <div class="form-group" id="editTargetUrlGroup">
            <label for="editTargetUrl">Target URL</label>
            <input type="text" id="editTargetUrl">
            <small class="capture-hint">Use $1, $2, etc. for regex capture groups</small>
          </div>
          
          <div class="form-group">
            <label for="editDomains">Limit to Domains</label>
            <input type="text" id="editDomains">
          </div>
          
          <div class="form-group">
            <label for="editPriority">Priority</label>
            <input type="number" id="editPriority" min="1" max="100">
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
      <div class="modal-content modal-small">
        <h2 id="profileModalTitle">New Profile</h2>
        <form id="profile-form">
          <div class="form-group">
            <label for="profileName">Profile Name</label>
            <input type="text" id="profileName" required placeholder="e.g., Production Debug">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Create</button>
            <button type="button" class="btn btn-secondary" id="cancelProfile">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
