<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HotSwap</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <h1>HotSwap</h1>
        <div class="header-controls">
          <button id="undoBtn" class="icon-btn" title="Undo (Ctrl+Z)" disabled>‚Ü∂</button>
          <button id="redoBtn" class="icon-btn" title="Redo (Ctrl+Y)" disabled>‚Ü∑</button>
          <button id="darkModeBtn" class="icon-btn" title="Toggle Dark Mode">üåô</button>
          <div class="global-toggle">
            <label class="switch">
              <input type="checkbox" id="globalEnabled">
              <span class="slider"></span>
            </label>
            <span id="globalStatus">Enabled</span>
          </div>
        </div>
      </div>
      <div class="header-options">
        <div class="header-left">
          <label class="csp-toggle">
            <input type="checkbox" id="stripCSP" checked>
            <span>Strip CSP</span>
          </label>
          <button id="domainToggleBtn" class="domain-toggle-btn" title="Toggle rules for current domain">
            <span id="currentDomain">--</span>
          </button>
        </div>
        <div class="profile-selector">
          <select id="profileSelect">
            <option value="default">Default Profile</option>
          </select>
          <button id="profileMenuBtn" class="icon-btn-small" title="Profile Options">‚ãÆ</button>
        </div>
      </div>
      <div id="profileMenu" class="dropdown-menu hidden">
        <button id="newProfileBtn">‚ûï New Profile</button>
        <button id="duplicateProfileBtn">üìã Duplicate Profile</button>
        <button id="renameProfileBtn">‚úèÔ∏è Rename Profile</button>
        <button id="deleteProfileBtn" class="danger">üóëÔ∏è Delete Profile</button>
      </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab-btn active" data-tab="rules">Rules</button>
      <button class="tab-btn" data-tab="logs">Logs</button>
      <button class="tab-btn" data-tab="help">Help</button>
      <button class="tab-btn" data-tab="import">Settings</button>
    </nav>

    <!-- Rules Tab -->
    <section id="rules-tab" class="tab-content active">
      <!-- Toolbar -->
      <div class="rules-toolbar">
        <div class="toolbar-left">
          <button id="toggleAddForm" class="btn btn-primary btn-sm">
            <span class="btn-icon">+</span> Add Rule
          </button>
          <div class="bulk-actions hidden" id="bulkActions">
            <button id="bulkDeleteBtn" class="btn btn-sm btn-danger">Delete Selected</button>
          </div>
        </div>
        <div class="toolbar-right">
          <input type="text" id="searchRules" class="search-input" placeholder="Search...">
          <select id="filterGroup" class="filter-select">
            <option value="">All Groups</option>
          </select>
        </div>
      </div>
      
      <!-- Bulk Select All -->
      <div class="select-all-row hidden" id="selectAllRow">
        <label class="checkbox-inline">
          <input type="checkbox" id="selectAllRules">
          <span>Select All (<span id="selectedCount">0</span> selected)</span>
        </label>
      </div>
      
      <!-- Add Rule Form -->
      <div id="addRuleFormContainer" class="add-rule-form-container hidden">
        <form id="add-rule-form" class="rule-form">
          <div class="form-row">
            <div class="form-group flex-2">
              <label for="ruleName">Rule Name</label>
              <input type="text" id="ruleName" placeholder="e.g., PCF Control Debug" required>
            </div>
            <div class="form-group flex-1">
              <label for="ruleType">Type</label>
              <select id="ruleType">
                <option value="redirect">Redirect</option>
                <option value="block">Block</option>
                <option value="modifyHeaders">Headers</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="ruleGroup">Group</label>
              <input type="text" id="ruleGroup" placeholder="e.g., PCF" list="groupsList">
              <datalist id="groupsList"></datalist>
            </div>
            <div class="form-group flex-1">
              <label>Color</label>
              <div class="color-picker">
                <button type="button" class="color-btn selected" data-color="" title="None">‚äò</button>
                <button type="button" class="color-btn" data-color="#EF4444" title="Red"></button>
                <button type="button" class="color-btn" data-color="#F59E0B" title="Orange"></button>
                <button type="button" class="color-btn" data-color="#10B981" title="Green"></button>
                <button type="button" class="color-btn" data-color="#3B82F6" title="Blue"></button>
                <button type="button" class="color-btn" data-color="#8B5CF6" title="Purple"></button>
              </div>
              <input type="hidden" id="ruleColor" value="">
            </div>
          </div>
          
          <div class="form-group">
            <label for="sourceUrl">Source URL Pattern</label>
            <input type="text" id="sourceUrl" placeholder="e.g., *bundle*.js or regex pattern" required>
            <div class="pattern-type">
              <label class="checkbox-inline">
                <input type="checkbox" id="useRegex"> Use Regex
              </label>
              <span class="pattern-hint" id="patternHint">Wildcards (*)</span>
            </div>
          </div>
          
          <div class="form-group" id="targetUrlGroup">
            <label for="targetUrl">Target URL</label>
            <input type="text" id="targetUrl" placeholder="e.g., http://localhost:8181/bundle.js">
            <small class="capture-hint">Tip: Use $1, $2 for regex capture groups</small>
          </div>
          
          <!-- Headers Section (for modifyHeaders type) -->
          <div class="form-group hidden" id="headersSection">
            <label>Headers to Modify</label>
            <div id="headersList" class="headers-list">
              <div class="header-row">
                <select class="header-operation">
                  <option value="set">Set</option>
                  <option value="remove">Remove</option>
                  <option value="append">Append</option>
                </select>
                <select class="header-type">
                  <option value="request">Request</option>
                  <option value="response">Response</option>
                </select>
                <input type="text" class="header-name" placeholder="Header name">
                <input type="text" class="header-value" placeholder="Value">
                <button type="button" class="btn-remove-header">√ó</button>
              </div>
            </div>
            <button type="button" id="addHeaderBtn" class="btn btn-sm btn-secondary">+ Add Header</button>
          </div>
          
          <div class="form-group">
            <label for="domains">Limit to Domains <span class="optional">(optional)</span></label>
            <input type="text" id="domains" placeholder="e.g., crm.dynamics.com">
          </div>
          
          <details class="advanced-options">
            <summary>Advanced Options</summary>
            <div class="form-group">
              <label>Resource Types</label>
              <div class="checkbox-group compact">
                <label><input type="checkbox" name="resourceType" value="script" checked> Scripts</label>
                <label><input type="checkbox" name="resourceType" value="xmlhttprequest" checked> XHR</label>
                <label><input type="checkbox" name="resourceType" value="stylesheet"> CSS</label>
                <label><input type="checkbox" name="resourceType" value="image"> Images</label>
                <label><input type="checkbox" name="resourceType" value="font"> Fonts</label>
                <label><input type="checkbox" name="resourceType" value="media"> Media</label>
                <label><input type="checkbox" name="resourceType" value="main_frame"> Main Frame</label>
                <label><input type="checkbox" name="resourceType" value="sub_frame"> Sub Frame</label>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="priority">Priority</label>
                <input type="number" id="priority" value="1" min="1" max="100" class="input-small">
              </div>
            </div>
          </details>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitRuleBtn">Add Rule</button>
            <button type="button" class="btn btn-secondary" id="cancelAddRule">Cancel</button>
          </div>
        </form>
      </div>
      
      <!-- Rules List -->
      <div id="rules-list" class="rules-list">
        <p class="empty-state">No rules configured. Click "Add Rule" to get started.</p>
      </div>
    </section>

    <!-- Help Tab -->
    <section id="help-tab" class="tab-content">
      <div class="help-about">
        <div class="help-logo">
          <span class="logo-icon">‚áÑ</span>
          <div class="logo-text">
            <h2>HotSwap</h2>
            <span class="version-badge">v1.1.1.0</span>
          </div>
        </div>
        <p class="help-tagline">URL Redirect, Block & Header Modification for Development</p>
        <div class="help-meta">
          <p><strong>Created by:</strong> Krunal Patel</p>
          <p><strong>License:</strong> MIT License</p>
          <p><a href="https://github.com/krunal039/HotSwap" target="_blank">GitHub Repository</a></p>
        </div>
      </div>

      <div class="help-divider"></div>

      <div class="help-section">
        <h3>Quick Start</h3>
        <ol class="help-steps">
          <li>Click <strong>"+ Add Rule"</strong></li>
          <li>Enter a <strong>Rule Name</strong> (e.g., "My PCF Debug")</li>
          <li>Select <strong>Type</strong>: Redirect, Block, or Headers</li>
          <li>Enter <strong>Source URL Pattern</strong> (e.g., <code>*bundle*.js</code>)</li>
          <li>Enter <strong>Target URL</strong> for redirects</li>
          <li>Click <strong>Add Rule</strong> and refresh your page!</li>
        </ol>
      </div>

      <div class="help-divider"></div>

      <div class="help-section">
        <h3>URL Patterns</h3>
        
        <h4>Simple Patterns (Regex OFF)</h4>
        <p class="help-description">Use <code>*</code> as a wildcard to match any characters.</p>
        <div class="help-examples">
          <div class="example">
            <code>*bundle*.js</code>
            <span>Matches any URL containing "bundle" ending in ".js"</span>
          </div>
          <div class="example">
            <code>*cdn.example.com/*.js</code>
            <span>Matches JS files from cdn.example.com</span>
          </div>
        </div>

        <h4>Regex Patterns with Capture Groups</h4>
        <p class="help-description">Use full regex syntax. Reference captured groups in target URL with $1, $2, etc.</p>
        <div class="help-examples">
          <div class="example">
            <code>.*/(bundle\.[A-Z0-9]+\.js)$</code>
            <span>Source: Captures filename in $1</span>
          </div>
          <div class="example">
            <code>http://localhost:8181/$1</code>
            <span>Target: Uses captured filename</span>
          </div>
        </div>

        <div class="help-warning">
          <strong>Common Mistake:</strong> Using <code>*bundle*.js</code> with Regex ON won't work! 
          In regex, <code>*</code> means "repeat previous character". Use <code>.*</code> instead.
        </div>
      </div>

      <div class="help-divider"></div>

      <div class="help-section">
        <h3>Features</h3>
        <ul class="help-features">
          <li><strong>Redirect:</strong> Replace production URLs with localhost for debugging</li>
          <li><strong>Block:</strong> Block unwanted requests (analytics, ads, etc.)</li>
          <li><strong>Headers:</strong> Add, remove, or modify HTTP headers</li>
          <li><strong>Capture Groups:</strong> Use $1, $2 in redirect URLs for dynamic rewriting</li>
          <li><strong>Profiles:</strong> Switch between different rule sets quickly</li>
          <li><strong>Groups & Colors:</strong> Organize rules with groups and color tags</li>
          <li><strong>Undo/Redo:</strong> Ctrl+Z / Ctrl+Y to undo and redo changes</li>
          <li><strong>Bulk Actions:</strong> Select and manage multiple rules at once</li>
          <li><strong>Keyboard Shortcuts:</strong> Navigate and manage rules with keyboard</li>
          <li><strong>Strip CSP Headers:</strong> Automatically removes CSP so localhost works</li>
          <li><strong>Dark Mode:</strong> Toggle with the moon icon</li>
          <li><strong>Import/Export:</strong> Share configurations as JSON</li>
        </ul>
      </div>

      <div class="help-divider"></div>

      <div class="help-section">
        <h3>Troubleshooting</h3>
        <div class="help-faq">
          <div class="faq-item">
            <strong>Rules not working?</strong>
            <p>Go to Settings > Click "View Chrome Rules". If empty, your pattern is invalid.</p>
          </div>
          <div class="faq-item">
            <strong>CSP Error?</strong>
            <p>Make sure "Strip CSP" is ON. Add the domain to "Limit to Domains" field.</p>
          </div>
          <div class="faq-item">
            <strong>Capture groups not working?</strong>
            <p>Make sure "Use Regex" is checked and parentheses surround what you want to capture.</p>
          </div>
          <div class="faq-item">
            <strong>Cached response loading?</strong>
            <p>Open DevTools > Network > check "Disable cache", then hard refresh (Ctrl+Shift+R).</p>
          </div>
        </div>
      </div>

      <div class="help-divider"></div>

      <div class="help-section help-license">
        <h3>MIT License</h3>
        <p>Copyright 2026 Krunal Patel</p>
        <p class="license-text">
          Permission is hereby granted, free of charge, to any person obtaining a copy of this software 
          to deal in the Software without restriction, including the rights to use, copy, modify, merge, 
          publish, distribute, sublicense, and/or sell copies of the Software.
        </p>
      </div>
    </section>

    <!-- Logs Tab -->
    <section id="logs-tab" class="tab-content">
      <div class="logs-header">
        <h3>Activity Logs</h3>
        <div class="logs-actions">
          <button id="exportCsvBtn" class="btn btn-secondary btn-small">Export CSV</button>
          <button id="resetStatsBtn" class="btn btn-secondary btn-small">Reset</button>
          <button id="clearLogsBtn" class="btn btn-secondary btn-small">Clear</button>
        </div>
      </div>
      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-value" id="totalRedirects">0</span>
          <span class="stat-label">Redirects</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="totalBlocks">0</span>
          <span class="stat-label">Blocks</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="totalHeaders">0</span>
          <span class="stat-label">Headers</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="activeRulesCount">0</span>
          <span class="stat-label">Active</span>
        </div>
      </div>
      
      <!-- Request Recording -->
      <div class="recording-section">
        <div class="recording-header">
          <label class="checkbox-inline">
            <input type="checkbox" id="recordRequests">
            <span>Record Requests</span>
          </label>
          <button id="clearRecordingBtn" class="btn btn-sm btn-secondary">Clear Recording</button>
        </div>
        <div id="recordedRequests" class="recorded-requests hidden">
          <p class="recording-hint">Click on a recorded request to create a rule for it</p>
          <div id="recordedList"></div>
        </div>
      </div>
      
      <div class="logs-info">
        <small>Activity logs. Cleared when extension reloads.</small>
      </div>
      <div id="logs-list" class="logs-list">
        <p class="empty-state">No activity yet.</p>
      </div>
    </section>

    <!-- Settings Tab -->
    <section id="import-tab" class="tab-content">
      <div class="import-export">
        <div class="form-group">
          <label>Export</label>
          <div class="export-buttons">
            <button id="exportBtn" class="btn btn-secondary">Export JSON</button>
            <button id="exportStatsBtn" class="btn btn-secondary">Export Stats CSV</button>
          </div>
        </div>
        
        <div class="form-group">
          <label>Import Rules</label>
          <textarea id="importData" placeholder="Paste JSON configuration..."></textarea>
          <button id="importBtn" class="btn btn-primary">Import</button>
        </div>
        
        <div class="form-group">
          <label>Keyboard Shortcuts</label>
          <div class="shortcuts-list">
            <div class="shortcut-item">
              <kbd>Ctrl+Shift+H</kbd> <span>Toggle HotSwap on/off</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl+Z</kbd> <span>Undo last action</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl+Y</kbd> <span>Redo action</span>
            </div>
            <div class="shortcut-item">
              <kbd>‚Üë/‚Üì</kbd> <span>Navigate rules</span>
            </div>
            <div class="shortcut-item">
              <kbd>Enter</kbd> <span>Edit selected rule</span>
            </div>
            <div class="shortcut-item">
              <kbd>Delete</kbd> <span>Delete selected rule</span>
            </div>
            <div class="shortcut-item">
              <kbd>Space</kbd> <span>Toggle selected rule</span>
            </div>
          </div>
        </div>
        
        <div class="form-group danger-zone">
          <label>Danger Zone</label>
          <button id="clearAllBtn" class="btn btn-danger">Clear All Rules</button>
        </div>
        
        <div class="form-group debug-section">
          <label>Debug Tools</label>
          <button id="viewActiveRulesBtn" class="btn btn-secondary">View Chrome Rules</button>
          <div id="activeRulesOutput" class="debug-output"></div>
        </div>
        
        <div class="form-group">
          <label>Test Pattern</label>
          <input type="text" id="testPattern" placeholder="Pattern">
          <label class="checkbox-inline" style="margin-top: 6px;">
            <input type="checkbox" id="testUseRegex"> Regex
          </label>
          <input type="text" id="testUrl" placeholder="URL to test" style="margin-top: 6px;">
          <button id="testPatternBtn" class="btn btn-secondary" style="margin-top: 6px;">Test</button>
          <div id="testResult" class="debug-output"></div>
        </div>
      </div>
    </section>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h2>Edit Rule</h2>
        <form id="edit-rule-form" class="rule-form">
          <input type="hidden" id="editIndex">
          
          <div class="form-group">
            <label for="editRuleName">Rule Name</label>
            <input type="text" id="editRuleName" required>
          </div>
          
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="editRuleType">Type</label>
              <select id="editRuleType">
                <option value="redirect">Redirect</option>
                <option value="block">Block</option>
                <option value="modifyHeaders">Headers</option>
              </select>
            </div>
            <div class="form-group flex-1">
              <label for="editRuleGroup">Group</label>
              <input type="text" id="editRuleGroup" list="editGroupsList">
              <datalist id="editGroupsList"></datalist>
            </div>
          </div>
          
          <div class="form-group">
            <label>Color</label>
            <div class="color-picker" id="editColorPicker">
              <button type="button" class="color-btn selected" data-color="" title="None">‚äò</button>
              <button type="button" class="color-btn" data-color="#EF4444" title="Red"></button>
              <button type="button" class="color-btn" data-color="#F59E0B" title="Orange"></button>
              <button type="button" class="color-btn" data-color="#10B981" title="Green"></button>
              <button type="button" class="color-btn" data-color="#3B82F6" title="Blue"></button>
              <button type="button" class="color-btn" data-color="#8B5CF6" title="Purple"></button>
            </div>
            <input type="hidden" id="editRuleColor" value="">
          </div>
          
          <div class="form-group">
            <label for="editSourceUrl">Source URL Pattern</label>
            <input type="text" id="editSourceUrl" required>
            <div class="pattern-type">
              <label class="checkbox-inline">
                <input type="checkbox" id="editUseRegex"> Use Regex
              </label>
            </div>
          </div>
          
          <div class="form-group" id="editTargetUrlGroup">
            <label for="editTargetUrl">Target URL</label>
            <input type="text" id="editTargetUrl">
          </div>
          
          <!-- Edit Headers Section -->
          <div class="form-group hidden" id="editHeadersSection">
            <label>Headers to Modify</label>
            <div id="editHeadersList" class="headers-list"></div>
            <button type="button" id="editAddHeaderBtn" class="btn btn-sm btn-secondary">+ Add Header</button>
          </div>
          
          <div class="form-row">
            <div class="form-group flex-2">
              <label for="editDomains">Limit to Domains</label>
              <input type="text" id="editDomains" placeholder="Optional">
            </div>
            <div class="form-group flex-1">
              <label for="editPriority">Priority</label>
              <input type="number" id="editPriority" min="1" max="100" value="1">
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
      <div class="modal-content modal-small">
        <h2 id="profileModalTitle">New Profile</h2>
        <form id="profile-form">
          <div class="form-group">
            <label for="profileName">Profile Name</label>
            <input type="text" id="profileName" required placeholder="e.g., Production Debug">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Create</button>
            <button type="button" class="btn btn-secondary" id="cancelProfile">Cancel</button>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Duplicate Warning Modal -->
    <div id="duplicateModal" class="modal">
      <div class="modal-content modal-small">
        <h2>‚ö†Ô∏è Possible Duplicate</h2>
        <p id="duplicateMessage"></p>
        <div class="form-actions">
          <button type="button" class="btn btn-primary" id="addAnyway">Add Anyway</button>
          <button type="button" class="btn btn-secondary" id="cancelDuplicate">Cancel</button>
        </div>
      </div>
    </div>
    
    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
      <div class="modal-content modal-small">
        <h2 id="confirmTitle">Confirm</h2>
        <p id="confirmMessage"></p>
        <div class="form-actions">
          <button type="button" class="btn btn-danger" id="confirmYes">Delete</button>
          <button type="button" class="btn btn-secondary" id="confirmNo">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
