<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Override</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <h1>HotSwap</h1>
        <div class="global-toggle">
          <label class="switch">
            <input type="checkbox" id="globalEnabled">
            <span class="slider"></span>
          </label>
          <span id="globalStatus">Enabled</span>
        </div>
      </div>
      <div class="header-options">
        <label class="csp-toggle">
          <input type="checkbox" id="stripCSP" checked>
          <span>Strip CSP Headers</span>
        </label>
      </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab-btn active" data-tab="rules">Rules</button>
      <button class="tab-btn" data-tab="logs">Logs</button>
      <button class="tab-btn" data-tab="help">Help</button>
      <button class="tab-btn" data-tab="import">Settings</button>
    </nav>

    <!-- Rules Tab (Combined Add/Edit/Delete) -->
    <section id="rules-tab" class="tab-content active">
      <!-- Add New Rule Button -->
      <div class="add-rule-header">
        <button id="toggleAddForm" class="btn btn-primary btn-add-new">
          <span class="btn-icon">+</span> Add New Rule
        </button>
      </div>
      
      <!-- Add Rule Form (Collapsible) -->
      <div id="addRuleFormContainer" class="add-rule-form-container hidden">
        <form id="add-rule-form" class="rule-form">
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="ruleName">Rule Name</label>
              <input type="text" id="ruleName" placeholder="e.g., PCF Control Debug" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="sourceUrl">Source URL Pattern</label>
            <input type="text" id="sourceUrl" placeholder="e.g., *bundle*.js or *cdn.example.com/*.js" required>
            <div class="pattern-type">
              <label class="checkbox-inline">
                <input type="checkbox" id="useRegex"> Use Regex Pattern
              </label>
              <span class="pattern-hint" id="patternHint">Using wildcards (*)</span>
            </div>
          </div>
          
          <div class="form-group">
            <label for="targetUrl">Target URL (Redirect To)</label>
            <input type="text" id="targetUrl" placeholder="e.g., http://localhost:8181/bundle.js" required>
          </div>
          
          <div class="form-group">
            <label for="domains">Limit to Domains <span class="optional">(optional)</span></label>
            <input type="text" id="domains" placeholder="e.g., crm.dynamics.com">
          </div>
          
          <details class="advanced-options">
            <summary>Advanced Options</summary>
            <div class="form-group">
              <label>Resource Types</label>
              <div class="checkbox-group compact">
                <label><input type="checkbox" name="resourceType" value="script" checked> Scripts</label>
                <label><input type="checkbox" name="resourceType" value="xmlhttprequest" checked> XHR</label>
                <label><input type="checkbox" name="resourceType" value="stylesheet"> CSS</label>
                <label><input type="checkbox" name="resourceType" value="image"> Images</label>
              </div>
            </div>
            <div class="form-group">
              <label for="priority">Priority</label>
              <input type="number" id="priority" value="1" min="1" max="100" class="input-small">
            </div>
          </details>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitRuleBtn">Add Rule</button>
            <button type="button" class="btn btn-secondary" id="cancelAddRule">Cancel</button>
          </div>
        </form>
      </div>
      
      <!-- Rules List -->
      <div id="rules-list" class="rules-list">
        <p class="empty-state">No redirect rules configured. Click "Add New Rule" to get started.</p>
      </div>
    </section>

    <!-- Logs Tab -->
    <section id="logs-tab" class="tab-content">
      <div class="logs-header">
        <h3>Redirect Logs</h3>
        <button id="clearLogsBtn" class="btn btn-secondary btn-small">Clear Logs</button>
      </div>
      <div class="logs-info">
        <small>Shows URLs that have been redirected by your rules. Logs are cleared when the extension reloads.</small>
      </div>
      <div id="logs-list" class="logs-list">
        <p class="empty-state">No redirects logged yet. Redirects will appear here when URLs match your rules.</p>
      </div>
    </section>

    <!-- Help Tab -->
    <section id="help-tab" class="tab-content">
      <!-- About Section -->
      <div class="help-about">
        <div class="help-logo">
          <span class="logo-icon">⇄</span>
          <div class="logo-text">
            <h2>HotSwap</h2>
            <span class="version-badge">v1.0.0</span>
          </div>
        </div>
        <p class="help-tagline">URL Redirect Extension for Development</p>
        <div class="help-meta">
          <p><strong>Created by:</strong> Krunal Patel</p>
          <p><strong>License:</strong> MIT License</p>
          <p><a href="https://github.com/krunal039/HotSwap" target="_blank">GitHub Repository</a></p>
        </div>
      </div>

      <div class="help-divider"></div>

      <!-- Quick Start -->
      <div class="help-section">
        <h3>Quick Start</h3>
        <ol class="help-steps">
          <li>Go to <strong>Add Rule</strong> tab</li>
          <li>Enter a <strong>Rule Name</strong> (e.g., "My PCF Debug")</li>
          <li>Enter <strong>Source URL Pattern</strong> (e.g., <code>*bundle*.js</code>)</li>
          <li>Enter <strong>Target URL</strong> (e.g., <code>https://localhost:8181/bundle.js</code>)</li>
          <li>Click <strong>Add Rule</strong></li>
          <li>Refresh your page!</li>
        </ol>
      </div>

      <div class="help-divider"></div>

      <!-- Pattern Help -->
      <div class="help-section">
        <h3>URL Patterns</h3>
        
        <h4>Simple Patterns (Regex OFF)</h4>
        <p class="help-description">Use <code>*</code> as a wildcard to match any characters.</p>
        <div class="help-examples">
          <div class="example">
            <code>*bundle*.js</code>
            <span>Matches any URL containing "bundle" ending in ".js"</span>
          </div>
          <div class="example">
            <code>*cdn.example.com/*.js</code>
            <span>Matches JS files from cdn.example.com</span>
          </div>
        </div>

        <h4>Regex Patterns (Regex ON)</h4>
        <p class="help-description">Use full JavaScript regex syntax for complex matching.</p>
        <div class="help-examples">
          <div class="example">
            <code>.*bundle\.[A-Z0-9]+\.js$</code>
            <span>Matches bundle.HASH.js files</span>
          </div>
          <div class="example">
            <code>.*\.dynamics\.com/.*\.js</code>
            <span>Matches JS from dynamics.com subdomains</span>
          </div>
        </div>

        <div class="help-warning">
          <strong>Common Mistake:</strong> Using <code>*bundle*.js</code> with Regex ON won't work! 
          In regex, <code>*</code> means "repeat previous character". Use <code>.*</code> instead.
        </div>
      </div>

      <div class="help-divider"></div>

      <!-- Features -->
      <div class="help-section">
        <h3>Features</h3>
        <ul class="help-features">
          <li><strong>Strip CSP Headers:</strong> Automatically removes Content-Security-Policy headers so localhost redirects work</li>
          <li><strong>Domain Filtering:</strong> Limit rules to specific domains (e.g., only on crm.dynamics.com)</li>
          <li><strong>Logs:</strong> View all redirected URLs in real-time</li>
          <li><strong>Import/Export:</strong> Share configurations as JSON</li>
        </ul>
      </div>

      <div class="help-divider"></div>

      <!-- Troubleshooting -->
      <div class="help-section">
        <h3>Troubleshooting</h3>
        <div class="help-faq">
          <div class="faq-item">
            <strong>Rules not working?</strong>
            <p>Go to Settings → Click "View Active Chrome Rules". If empty, your pattern is invalid.</p>
          </div>
          <div class="faq-item">
            <strong>CSP Error?</strong>
            <p>Make sure "Strip CSP Headers" is ON. Add the domain to "Limit to Domains" field.</p>
          </div>
          <div class="faq-item">
            <strong>No logs showing?</strong>
            <p>Use Settings → "Test Pattern" to verify your pattern matches the URL.</p>
          </div>
        </div>
      </div>

      <div class="help-divider"></div>

      <!-- License -->
      <div class="help-section help-license">
        <h3>MIT License</h3>
        <p>Copyright © 2026 Krunal Patel</p>
        <p class="license-text">
          Permission is hereby granted, free of charge, to any person obtaining a copy of this software 
          to deal in the Software without restriction, including the rights to use, copy, modify, merge, 
          publish, distribute, sublicense, and/or sell copies of the Software.
        </p>
      </div>
    </section>

    <!-- Import/Export Tab -->
    <section id="import-tab" class="tab-content">
      <div class="import-export">
        <div class="form-group">
          <label>Export Rules</label>
          <button id="exportBtn" class="btn btn-secondary">Export to JSON</button>
        </div>
        
        <div class="form-group">
          <label>Import Rules</label>
          <textarea id="importData" placeholder="Paste JSON configuration here..."></textarea>
          <button id="importBtn" class="btn btn-primary">Import Rules</button>
        </div>
        
        <div class="form-group danger-zone">
          <label>Danger Zone</label>
          <button id="clearAllBtn" class="btn btn-danger">Clear All Rules</button>
        </div>
        
        <div class="form-group debug-section">
          <label>Debug Tools</label>
          <button id="viewActiveRulesBtn" class="btn btn-secondary">View Active Chrome Rules</button>
          <div id="activeRulesOutput" class="debug-output"></div>
        </div>
        
        <div class="form-group">
          <label>Test Pattern</label>
          <input type="text" id="testPattern" placeholder="Your pattern (e.g., *bundle*.js)">
          <label class="checkbox-inline" style="margin-top: 6px;">
            <input type="checkbox" id="testUseRegex"> Regex
          </label>
          <input type="text" id="testUrl" placeholder="URL to test against" style="margin-top: 6px;">
          <button id="testPatternBtn" class="btn btn-secondary" style="margin-top: 6px;">Test Match</button>
          <div id="testResult" class="debug-output"></div>
        </div>
        
      </div>
    </section>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h2>Edit Rule</h2>
        <form id="edit-rule-form" class="rule-form">
          <input type="hidden" id="editIndex">
          
          <div class="form-group">
            <label for="editRuleName">Rule Name</label>
            <input type="text" id="editRuleName" required>
          </div>
          
          <div class="form-group">
            <label for="editSourceUrl">Source URL Pattern</label>
            <input type="text" id="editSourceUrl" required>
            <div class="pattern-type">
              <label class="checkbox-inline">
                <input type="checkbox" id="editUseRegex"> Use Regex Pattern
              </label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="editTargetUrl">Target URL</label>
            <input type="text" id="editTargetUrl" required>
          </div>
          
          <div class="form-group">
            <label for="editDomains">Limit to Domains</label>
            <input type="text" id="editDomains">
          </div>
          
          <div class="form-group">
            <label for="editPriority">Priority</label>
            <input type="number" id="editPriority" min="1" max="100">
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button type="button" class="btn btn-secondary" id="cancelEdit">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
